# [IIC相关知识链接](https://www.cnblogs.com/liujinggang/p/9656358.html)  
## IIC总线协议详解：  
IIC总线接口是一个标准的双向传输接口，一次数据传输需要主机和从机按照IIC协议的标准进行。I2C总线是由数据线SDA和时钟SCL构成的串行总线，可发送和接收数据，并且在硬件上都需要接一个上拉电阻到VCC。各种被控制电路均并联在这条总线上，但就像电话机一样只有拨通各自的号码才能工作，所以每个电路和模块都有唯一的地址，这样，各控制电路虽然挂在同一条总线上，却彼此独立，互不相关。
### IIC主机往从机里面写入数据的步骤如下：  
1、 主机发送一个**起始信号**和**从机的设备地址**给从机  
2、 主机发送**数据**给从机  
3、 主机发送一个**停止信号**结束发送过程  
### IIC主机从从机里面读出数据的步骤如下：
1、 主机发送一个**起始信号**和**从机的设备地址**给从机  
2、 主机发送一个要****读取的地址**给从机  
3、 主机从从机接收数据  
4、 主机发送一个****停止信号**给从机结束整个接收过程  
## IIC总线在通信的过程中一共有一下几种状态：  
### 1、**空闲状态**  
IIC 总线的 SDA 和 SCL 两条信号线同时处于高电平时，规定为总线的空闲状态。此时各个器件的输出级场效应管均处在截止状态，即释放总线，由两条信号线各自的上拉电阻把电平拉高。  
### 2、起始状态和结束状态
在时钟线 SCL 保持高电平期间，数据线 SDA 上的电平被拉低(即负跳变)，定义为 I2C 总线总线的起始信号，它标志着一次数据传输的开始。起始信号是由主控器主动建立的，在建立该信号之前 I2C 总线必须处于空闲状态。  
在时钟线 SCL 保持高电平期间，数据线 SDA 被释放，使得 SDA 返回高电平(即正跳变)，称为 I2C 总线的停止信号，它标志着一次数据传输的终止。停止信号也是由主控器主动建立的，建立该信号之后，I2C 总线将返回空闲状态。  
### 3、有效的数据位传输  
在 IIC 总线上传送的每一位数据都有一个时钟脉冲相对应(或同步控制)，即在 SCL 串行时钟的配合下，数据在 SDA 上从高位向低位依次串行传送每一位的数据。进行数据传送时，在 SCL 呈现高电平期间，SDA 上的电平必须保持稳定，低电平为数据 0，高电平为数据 1。只有在 SCL 为低电平期间，才允许 SDA 上的电平改变状态。 
### 4、应答信号与非应答信号  
I2C 总线上的所有数据都是以 8 位字节传送的，发送器(主机)每发送一个字节，就在第9个时钟脉冲期间释放数据线，由接收器(从机)反馈一个应答信号。**应答信号为低电平**时，规定为**有效应答位**(ACK简称应答位)，表示接收器已经成功地接收了该字节；应答信号为高电平时，规定为非应答位(NACK)，一般表示接收器接收该字节没有成功。对于反馈有效应答位 ACK 的要求是，接收器在第 9 个时钟脉冲之前的低电平期间将 SDA 线拉低，并且确保在该时钟的高电平期间为稳定的低电平  
对非应答位(**NACK**)还要特别说明的是，还有以下四种情况IIC通信过程中会产生非应答位：  
1、接收器(从机)正在处理某些实时的操作无法与主机实现IIC通信的时候，接收器(从机)会给主机反馈一个非应答位(NACK)  
2、主机发送数据的过程中，从机无法解析发送的数据，接收器(从机)也会给主机反馈一个非应答位(NACK)  
3、主机发送数据的过程中，从机无法再继续接收数据，接收器(从机)也会给主机反馈一个非应答位(NACK)  
4、主机从从机中读取数据的过程中，主机不想再接收数据，主机会给从机反馈一个非应答位(NACK)，注意，这种情况是主机给从机反馈一个非应答位(NACK)  
### IIC挂机（lockup）处理：  
主设备将SDA置高（高阻），SCL连续发送9个完整的时钟，之后跟个（stop）即可解决  
### SCL可以不是那种很规律的时钟信号，可以自己设置，并不是真的时钟，他就像一个通信的标尺