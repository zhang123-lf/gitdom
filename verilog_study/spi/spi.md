# [spi定义](https://ica123.com/archives/11432)  
一种高速、**全双工的同步串行**控制总线，主要用于芯片之间的传输。其**优点**为：硬件实现简单；通讯先比较少（通常为4pin，有利于芯片封装）；通讯速度相较uart和iic而言较快，pcb布线容易，驱动程序相对简单。**缺点**：数据没有应答，需要上层硬件，软件来保证传输数据的正确性  
spi接口支持一主多从或者一主一从。其中**主芯片**发送`sclk`，`mosi`，`/ss`；主芯片接收`miso`信号。**从芯片**接收主芯片发送的信号，并**使用主芯片的时钟sclk**，返回（输出）`miso信号`给主芯片  
主设备可以有多个片选信号（ss）,每个ss信号分别对应一个从设备，一般情况下，ss信号为低电平有效 
所有miso信号（从设备发出）共用一条miso信号线  
没有被ss选择的设备，设备内部miso需要**高阻**  
从设备共用主设备发出的sclk，mosi信号（广播）  

## spi四种通讯模式  
总线空闲时sclk的状态（`CPOL`）:没有数据传输时，时钟的空闲状态的电平  
数据采样位置（`CPHA`）：数据在什么位置采样  
这样就产生了四种状态**时钟极性(clock polarity)**`CPOL`(0,1)和**时钟相位(clock phase)**`CPHA`(0,1)  
`CHPA=0`：表示在片选后（片选信号成立，有效），**第一个时钟边沿**采集数据；  
`CPHA=1`：表示在片选后（片选信号成立，有效）,**第二个时钟边沿**采集数据；  
`CPOL=0`：表示初始sclk电平为低；`CPOL=1`：表示初始sclk电平为高；  
（CPOL,CPHA）=(1,0)表示sclk空闲时为高电平，采样时刻为第一个边沿，即下降沿  
## 简单的spi verilog模块和仿真
### 默认CPOL = 0;CPHA = 0，总线空闲状态下sclk为低电平，上升沿采样数据
test_spi.v ：实现一个简单的spi收发